# Grenade CD
scoreboard players remove @a[scores={has_tnt=1,tick_elapsed=1..}] tick_elapsed 1

# Players' Rotation
execute as @a store result score @s gen_rotation run data get entity @s Rotation[0] 1.0

execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45] run playsound entity.creeper.primed master @a[distance=..2] ~ ~ ~ 1 1

# Negative Rotation
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-180..-172}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.0d,0.2d,-1.5d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-171..-163}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.234d,0.2d,-1.482d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-162..-154}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.464d,0.2d,-1.427d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-153..-145}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.681d,0.2d,-1.337d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-144..-136}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.882d,0.2d,-1.214d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-135..-127}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.061d,0.2d,-1.061d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-126..-118}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.214d,0.2d,-0.882d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-117..-109}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.337d,0.2d,-0.681d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-108..-100}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.427d,0.2d,-0.464d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-99..-91}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.482d,0.2d,-0.234d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-90..-82}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.5d,0.2d,0.0d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-81..-73}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.482d,0.2d,0.234d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-72..-64}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.427d,0.2d,0.464d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-63..-55}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.337d,0.2d,0.681d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-54..-46}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.214d,0.2d,0.882d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-45..-37}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[1.061d,0.2d,1.061d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-36..-28}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.882d,0.2d,1.214d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-27..-19}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.681d,0.2d,1.337d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-18..-10}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.464d,0.2d,1.427d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=-9..-1}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.234d,0.2d,1.482d]}

# Positive Rotation
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=0..8}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[0.0d,0.2d,1.5d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=9..17}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.234d,0.2d,1.482d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=18..26}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.464d,0.2d,1.427d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=27..35}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.681d,0.2d,1.337d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=36..44}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.882d,0.2d,1.214d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=45..53}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.061d,0.2d,1.061d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=54..62}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.214d,0.2d,0.882d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=63..71}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.337d,0.2d,0.681d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=72..80}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.427d,0.2d,0.464d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=81..89}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.482d,0.2d,0.234d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=90..98}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.5d,0.2d,0.0d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=99..107}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.482d,0.2d,-0.234d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=108..116}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.427d,0.2d,-0.464d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=117..125}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.337d,0.2d,-0.681d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=126..134}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.214d,0.2d,-0.882d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=135..143}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-1.061d,0.2d,-1.061d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=144..152}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.882d,0.2d,-1.214d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=153..161}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.681d,0.2d,-1.337d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=162..170}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.464d,0.2d,-1.427d]}
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45,scores={gen_rotation=171..180}] run summon armor_stand ~ ~ ~ {Small:1b,Tags:["grenade"],Invisible:1b,ArmorItems:[{},{},{},{id:"minecraft:tnt",Count:1b,tag:{Enchantments:[{id:"minecraft:protection",lvl:1s}]}}],Motion:[-0.234d,0.2d,-1.482d]}

# Reset CD
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45] run scoreboard players set @a[limit=1,sort=nearest] tick_elapsed 200
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45] run scoreboard players operation @a[limit=1,sort=nearest] TMP = ROUND_TIME tick_elapsed
execute as @e[type=item,nbt={Item:{tag:{Grenade:1b}}}] at @s if entity @a[limit=1,distance=..1.45] run scoreboard players operation @e[limit=1,sort=nearest,type=armor_stand,tag=grenade] TMP = ROUND_TIME tick_elapsed

# Impact of a Grenade
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s run particle explosion ~ ~ ~ 0.1 0.1 0.1 0.15 3
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s run particle smoke ~ ~1 ~ 0.4 0.4 0.4 0.1 200
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s run playsound entity.generic.explode master @a[distance=..16] ~ ~ ~ 1 1
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s if entity @a[gamemode=adventure,scores={has_tnt=0},distance=..2.5] run execute as @a[scores={has_tnt=1},gamemode=adventure] if score @e[tag=grenade,type=armor_stand,nbt={OnGround:1b},limit=1] TMP = @s TMP run function game:rewards/spread
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s if entity @a[gamemode=adventure,scores={has_tnt=0},distance=..2.5] run execute as @a[gamemode=adventure,scores={has_tnt=0},distance=..2.5] run function game:rewards/receive_tnt
execute as @e[tag=grenade,type=armor_stand,nbt={OnGround:1b}] at @s run kill @s

# Grenade particles
execute as @e[tag=grenade,type=armor_stand] at @s run particle flame ~ ~1.5 ~ 0.1 0.1 0.1 0.1 2